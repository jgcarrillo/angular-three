"use strict";(self.webpackChunksandbox=self.webpackChunksandbox||[]).push([[352],{6352:(_t,at,l)=>{l.d(at,{hJ:()=>M.h,wj:()=>c.wj,vc:()=>It.vc,YS:()=>jt.YS}),l(7017),l(8649),l(5936),l(2610),l(8187),l(5648),l(752),l(5413);var M=l(4480),c=l(9445);l(744);var It=l(7389),wt=(l(1412),l(4479),l(6963));l(475),l(8441),l(8527),new wt.Pa4;var jt=l(6758);l(280),l(181),l(563),l(5621)},4480:(_t,at,l)=>{l.d(at,{g:()=>J,h:()=>dt});var u=l(7017),ht=l(1445),bt=l(5936),Z=l(258),rt=l(2610),j=l(8427),w=l(1487),$=l(6963);const yt={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},ct={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n\n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "};var y=l(1858),K=l(8187),pt=l(5648),ot=l(752),C=l(4926),H=l(1480),o=l(5959);const z=function(P){return[1,P,1]},L=function(P){return[P,0,0]},n=function(P,W,a,F,I){return[P,W,a,F,0,I]};function it(P,W){if(1&P&&(y.ynx(0),y.TgZ(1,"ngt-mesh",2),y.ALo(2,"radian"),y._UZ(3,"ngt-mesh-basic-material",3),y.qZA(),y._UZ(4,"ngt-orthographic-camera",4),y.BQk()),2&P){const a=W.ngIf,F=y.oxw();y.xp6(1),y.Q6J("geometry",a.planeGeometry)("scale",y.VKq(10,z,-1))("rotation",y.VKq(12,L,y.lcZ(2,8,-90))),y.xp6(2),y.Q6J("map",a.renderTarget.texture)("opacity",a.opacity)("depthWrite",a.depthWrite),y.xp6(1),y.Q6J("ref",F.shadowCameraRef)("args",y.qbA(14,n,-a.width/2,a.width/2,a.height/2,-a.height/2,a.far))}}let J=(()=>{class P extends u.Fq{constructor(){super(...arguments),this.count=1,this.shadowViewModel$=this.select(this.select(a=>a.priority),this.select(a=>a.planeGeometry),this.select(a=>a.renderTarget),this.select(a=>a.opacity),this.select(a=>a.depthWrite),this.select(a=>a.scaledWidth),this.select(a=>a.scaledHeight),this.select(a=>a.far),(a,F,I,D,V,Q,Y,k)=>({priority:a,planeGeometry:F,renderTarget:I,opacity:D,depthWrite:V,width:Q,height:Y,far:k})),this.setShadows=this.effect((0,w.b)(()=>{const{resolution:a,scaledWidth:F,scaledHeight:I,color:D}=this.get(),V=this.store.get(O=>O.gl),Q=new $.dd2(a,a);Q.texture.encoding=V.outputEncoding;const Y=new $.dd2(a,a);Y.texture.generateMipmaps=Q.texture.generateMipmaps=!1;const k=new $.BKK(F,I).rotateX(Math.PI/2),f=new $.Kj0(k),M=new $.lRF;M.depthTest=M.depthWrite=!1,M.onBeforeCompile=O=>{O.uniforms=Object.assign(Object.assign({},O.uniforms),{ucolor:{value:new $.Ilk(D).convertSRGBToLinear()}}),O.fragmentShader=O.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),O.fragmentShader=O.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor, ( 1.0 - fragCoordZ ) * 1.0 );")};const c=new $.jyz(yt),N=new $.jyz(ct);N.depthTest=c.depthTest=!1,this.zone.run(()=>{this.set({renderTarget:Q,planeGeometry:k,depthMaterial:M,blurPlane:f,horizontalBlurMaterial:c,verticalBlurMaterial:N,renderTargetBlur:Y})})}))}set opacity(a){this.set({opacity:(0,u.su)(a)})}set width(a){this.set({width:(0,u.su)(a)})}set height(a){this.set({height:(0,u.su)(a)})}set blur(a){this.set({blur:(0,u.su)(a)})}set far(a){this.set({far:(0,u.su)(a)})}set smooth(a){this.set({smooth:(0,u.Ig)(a)})}set resolution(a){this.set({resolution:(0,u.su)(a)})}set frames(a){this.set({frames:(0,u.su)(a)})}set depthWrite(a){this.set({depthWrite:(0,u.Ig)(a)})}get planeGeometry(){return this.get(a=>a.planeGeometry)}get renderTarget(){return this.get(a=>a.renderTarget)}get opacity(){return this.get(a=>a.opacity)}get depthWrite(){return this.get(a=>a.depthWrite)}get width(){return this.get(a=>a.scaledWidth)}get height(){return this.get(a=>a.scaledHeight)}get far(){return this.get(a=>a.far)}get shadowCameraRef(){return this.get(a=>a.shadowCameraRef)}preInit(){super.preInit(),this.set(a=>{var F,I,D,V,Q,Y,k,f,M;return{shadowCameraRef:new u.Rl,scale:u.is.equ(a.scale.toArray(),(0,u.Ut)(1).toArray())?(0,u.Ut)(10):a.scale,frames:null!==(F=a.frames)&&void 0!==F?F:1/0,opacity:null!==(I=a.opacity)&&void 0!==I?I:1,width:null!==(D=a.width)&&void 0!==D?D:1,height:null!==(V=a.height)&&void 0!==V?V:1,blur:null!==(Q=a.blur)&&void 0!==Q?Q:1,far:null!==(Y=a.far)&&void 0!==Y?Y:10,resolution:null!==(k=a.resolution)&&void 0!==k?k:512,smooth:null===(f=a.smooth)||void 0===f||f,color:u.is.equ(a.color.toArray(),(0,u.EH)().toArray())?(0,u.EH)("#000000"):a.color,depthWrite:null!==(M=a.depthWrite)&&void 0!==M&&M}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.set(this.select(this.select(a=>a.width),this.select(a=>a.height),this.select(a=>a.scale),(a,F,I)=>({scaledWidth:a*I.x,scaledHeight:F*I.y}))),this.setShadows(this.select(this.select(a=>a.resolution),this.select(a=>a.scaledWidth),this.select(a=>a.scaledHeight),this.select(a=>a.scale),this.select(a=>a.color)))})})}onBeforeRender(a){a.scale.setScalar(1);const{shadowCameraRef:F,frames:I,depthMaterial:D,renderTarget:V,smooth:Q,blur:Y}=this.get(),k=this.store.get(M=>M.gl),f=this.store.get(M=>M.scene);if(F.value&&V&&(I===1/0||this.count<I)){const M=f.background;f.background=null;const c=f.overrideMaterial;f.overrideMaterial=D,k.setRenderTarget(V),k.render(f,F.value),f.overrideMaterial=c,this.blurShadows(Y),Q&&this.blurShadows(.4*Y),k.setRenderTarget(null),f.background=M,this.count++}}blurShadows(a){const{renderTarget:F,blurPlane:I,horizontalBlurMaterial:D,verticalBlurMaterial:V,renderTargetBlur:Q,shadowCameraRef:Y}=this.get(),k=this.store.get(f=>f.gl);I.visible=!0,I.material=D,D.uniforms.tDiffuse.value=F.texture,D.uniforms.h.value=a/256,k.setRenderTarget(Q),k.render(I,Y.value),I.material=V,V.uniforms.tDiffuse.value=Q.texture,V.uniforms.v.value=a/256,k.setRenderTarget(F),k.render(I,Y.value),I.visible=!1}}return P.\u0275fac=function(){let W;return function(F){return(W||(W=y.n5z(P)))(F||P)}}(),P.\u0275cmp=y.Xpm({type:P,selectors:[["ngt-soba-contact-shadows"]],inputs:{opacity:"opacity",width:"width",height:"height",blur:"blur",far:"far",smooth:"smooth",resolution:"resolution",frames:"frames",depthWrite:"depthWrite"},features:[y._Bn([(0,u.Hm)(P)]),y.qOj],decls:4,vars:10,consts:[["name","soba-contact-shadows",3,"ngtObjectInputs","ngtObjectOutputs","rotation","beforeRender"],[4,"ngIf"],[3,"geometry","scale","rotation"],["transparent","",3,"map","opacity","depthWrite"],[3,"ref","args"]],template:function(a,F){1&a&&(y.TgZ(0,"ngt-group",0),y.NdJ("beforeRender",function(D){return F.onBeforeRender(D.object)}),y.ALo(1,"radian"),y.YNc(2,it,5,20,"ng-container",1),y.ALo(3,"async"),y.qZA()),2&a&&(y.Q6J("ngtObjectInputs",F)("ngtObjectOutputs",F)("rotation",y.VKq(8,L,y.lcZ(1,4,90))),y.xp6(2),y.Q6J("ngIf",y.lcZ(3,6,F.shadowViewModel$)))},directives:[K.U,pt.V,j.O5,ot.o,C.$,H.p],pipes:[o.j,j.Ov],encapsulation:2,changeDetection:0}),P})(),dt=(()=>{class P{}return P.\u0275fac=function(a){return new(a||P)},P.\u0275mod=y.oAB({type:P}),P.\u0275inj=y.cJS({imports:[[bt.I,u.y2,u.kZ,rt.M$,Z.g4,ht.bS,j.ez]]}),P})()},9445:(_t,at,l)=>{l.d(at,{$5:()=>Ht,wj:()=>jt});var u=l(7017),ht=l(1445),bt=l(8649),Z=l(258),rt=l(2610),j=l(8427),w=l(3255),$=l(1375),yt=l(7411),ct=l(1836),y=l(5359),K=l(1487),pt=l(1926),ot=l(506),C=l(2402),H=l(377),o=l(6963);class z extends o.yxD{constructor(p){super(p),this.type=o.cLu}parse(p){const d=function(s,e){switch(s){case 1:console.error("THREE.RGBELoader Read Error: "+(e||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(e||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(e||""));break;default:console.error("THREE.RGBELoader: Error: "+(e||""))}return-1},nt=function(s,e,h){e=e||1024;let S=s.pos,_=-1,m=0,B="",R=String.fromCharCode.apply(null,new Uint16Array(s.subarray(S,S+128)));for(;0>(_=R.indexOf("\n"))&&m<e&&S<s.byteLength;)B+=R,m+=R.length,S+=128,R+=String.fromCharCode.apply(null,new Uint16Array(s.subarray(S,S+128)));return-1<_&&(!1!==h&&(s.pos+=m+_+1),B+R.slice(0,_))},Ft=function(s,e,h,b){const _=Math.pow(2,s[e+3]-128)/255;h[b+0]=s[e+0]*_,h[b+1]=s[e+1]*_,h[b+2]=s[e+2]*_,h[b+3]=1},Pt=function(s,e,h,b){const _=Math.pow(2,s[e+3]-128)/255;h[b+0]=o.A5E.toHalfFloat(Math.min(s[e+0]*_,65504)),h[b+1]=o.A5E.toHalfFloat(Math.min(s[e+1]*_,65504)),h[b+2]=o.A5E.toHalfFloat(Math.min(s[e+2]*_,65504)),h[b+3]=o.A5E.toHalfFloat(1)},Rt=new Uint8Array(p);Rt.pos=0;const g=function(s){const h=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,b=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,S=/^\s*FORMAT=(\S+)\s*$/,_=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,m={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let B,R;if(s.pos>=s.byteLength||!(B=nt(s)))return d(1,"no header found");if(!(R=B.match(/^#\?(\S+)/)))return d(3,"bad initial token");for(m.valid|=1,m.programtype=R[1],m.string+=B+"\n";B=nt(s),!1!==B;)if(m.string+=B+"\n","#"!==B.charAt(0)){if((R=B.match(h))&&(m.gamma=parseFloat(R[1])),(R=B.match(b))&&(m.exposure=parseFloat(R[1])),(R=B.match(S))&&(m.valid|=2,m.format=R[1]),(R=B.match(_))&&(m.valid|=4,m.height=parseInt(R[1],10),m.width=parseInt(R[2],10)),2&m.valid&&4&m.valid)break}else m.comments+=B+"\n";return 2&m.valid?4&m.valid?m:d(3,"missing image size specifier"):d(3,"missing format specifier")}(Rt);if(-1!==g){const s=g.width,e=g.height,h=function(s,e,h){const b=e;if(b<8||b>32767||2!==s[0]||2!==s[1]||128&s[2])return new Uint8Array(s);if(b!==(s[2]<<8|s[3]))return d(3,"wrong scanline width");const S=new Uint8Array(4*e*h);if(!S.length)return d(4,"unable to allocate buffer space");let _=0,m=0;const B=4*b,R=new Uint8Array(4),G=new Uint8Array(B);let Nt=h;for(;Nt>0&&m<s.byteLength;){if(m+4>s.byteLength)return d(1);if(R[0]=s[m++],R[1]=s[m++],R[2]=s[m++],R[3]=s[m++],2!=R[0]||2!=R[1]||(R[2]<<8|R[3])!=b)return d(3,"bad rgbe scanline format");let st,ft=0;for(;ft<B&&m<s.byteLength;){st=s[m++];const gt=st>128;if(gt&&(st-=128),0===st||ft+st>B)return d(3,"bad scanline data");if(gt){const vt=s[m++];for(let zt=0;zt<st;zt++)G[ft++]=vt}else G.set(s.subarray(m,m+st),ft),ft+=st,m+=st}const Gt=b;for(let gt=0;gt<Gt;gt++){let vt=0;S[_]=G[gt+vt],vt+=b,S[_+1]=G[gt+vt],vt+=b,S[_+2]=G[gt+vt],vt+=b,S[_+3]=G[gt+vt],_+=4}Nt--}return S}(Rt.subarray(Rt.pos),s,e);if(-1!==h){let b,S,_,m;switch(this.type){case o.VzW:m=h.length/4;const B=new Float32Array(4*m);for(let G=0;G<m;G++)Ft(h,4*G,B,4*G);b=B,_=o.VzW;break;case o.cLu:m=h.length/4;const R=new Uint16Array(4*m);for(let G=0;G<m;G++)Pt(h,4*G,R,4*G);b=R,_=o.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:e,data:b,header:g.string,gamma:g.gamma,exposure:g.exposure,format:S,type:_}}}return null}setDataType(p){return this.type=p,this}load(p,t,i,v){return super.load(p,function E(x,d){switch(x.type){case o.VzW:case o.cLu:x.encoding=o.rnI,x.minFilter=o.wem,x.magFilter=o.wem,x.generateMipmaps=!1,x.flipY=!0}t&&t(x,d)},i,v)}}var L=l(744),n=l(1858),it=l(4315),J=l(4472),dt=l(752),P=l(9917),W=l(9500),a=l(4707);const F=["map",""],I=["*"];function D(r,p){1&r&&n.GkF(0)}const V=function(r,p,t){return[r,p,t]};function Q(r,p){if(1&r){const t=n.EpF();n.TgZ(0,"ngt-cube-camera",5),n.NdJ("beforeRender",function(){return n.CHM(t),n.oxw().onBeforeRender()}),n.qZA()}if(2&r){const t=p.ngIf,i=n.oxw();n.Q6J("ref",i.cubeCamera)("args",n.kEZ(2,V,i.near,i.far,t))}}function Y(r,p){if(1&r&&n._UZ(0,"ngt-soba-environment-cube",6),2&r){const t=n.oxw();n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function k(r,p){if(1&r&&n._UZ(0,"ngt-soba-environment-map",7),2&r){const t=n.oxw();n.Q6J("ngtSobaEnvironmentPassThrough",t)("map",t.map)}}const f=function(){return[1,16]};function M(r,p){if(1&r&&(n.ynx(0),n._UZ(1,"ngt-soba-environment-map",1),n.TgZ(2,"ngt-mesh",2),n._UZ(3,"ngt-icosahedron-geometry",3)(4,"ngt-shader-material",4),n.ALo(5,"side"),n.qZA(),n.BQk()),2&r){const t=p.ngIf,i=n.oxw();n.xp6(1),n.Q6J("ngtSobaEnvironmentPassThrough",i)("map",t.texture),n.xp6(1),n.Q6J("scale",t.scale),n.xp6(1),n.Q6J("args",n.DdM(11,f)),n.xp6(1),n.Q6J("ref",i.materialRef)("side",n.lcZ(5,9,"back"))("vertexShader",i.vertexShader)("fragmentShader",t.fragment)("uniforms",i.uniforms)}}function c(r,p){if(1&r&&n._UZ(0,"ngt-soba-environment-ground",2),2&r){const t=n.oxw();n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function N(r,p){if(1&r&&n._UZ(0,"ngt-soba-environment-map",5),2&r){const t=n.oxw(2);n.Q6J("ngtSobaEnvironmentPassThrough",t)("map",t.map)}}function O(r,p){1&r&&n.GkF(0)}function A(r,p){if(1&r&&n.YNc(0,O,1,0,"ng-container",8),2&r){const t=n.oxw(4);n.Q6J("ngTemplateOutlet",t.content.templateRef)}}function X(r,p){if(1&r&&(n.TgZ(0,"ngt-soba-environment-portal",2),n.YNc(1,A,1,1,"ng-template",7),n.qZA()),2&r){const t=n.oxw(3);n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function q(r,p){if(1&r&&n._UZ(0,"ngt-soba-environment-cube",2),2&r){const t=n.oxw(3);n.Q6J("ngtSobaEnvironmentPassThrough",t)}}function lt(r,p){if(1&r&&(n.YNc(0,X,2,1,"ngt-soba-environment-portal",0),n.YNc(1,q,1,1,"ng-template",null,6,n.W1O)),2&r){const t=n.MAs(2),i=n.oxw(2);n.Q6J("ngIf",!!i.content)("ngIfElse",t)}}function xt(r,p){if(1&r&&(n.YNc(0,N,1,2,"ngt-soba-environment-map",3),n.YNc(1,lt,3,2,"ng-template",null,4,n.W1O)),2&r){const t=n.MAs(2),i=n.oxw();n.Q6J("ngIf",!!i.map)("ngIfElse",t)}}const wt=r=>!!r&&r.isCubeTexture;function Ct(r){return u.is.ref(r)?r.value:r}let tt=(()=>{class r extends u.WZ{get frames(){return this.get(t=>t.frames)}set frames(t){this.set({frames:(0,u.su)(t)})}get near(){return this.get(t=>t.near)}set near(t){this.set({near:(0,u.su)(t)})}get far(){return this.get(t=>t.far)}set far(t){this.set({far:(0,u.su)(t)})}get resolution(){return this.get(t=>t.resolution)}set resolution(t){this.set({resolution:(0,u.su)(t)})}get background(){return this.get(t=>t.background)}set background(t){this.set({background:"only"===t?t:(0,u.Ig)(t)})}get map(){return this.get(t=>t.map)}set map(t){this.set({map:t})}get files(){return this.get(t=>t.files)}set files(t){this.set({files:t})}get path(){return this.get(t=>t.path)}set path(t){this.set({path:t})}get preset(){return this.get(t=>t.preset)}set preset(t){this.set({preset:t})}get scene(){return this.get(t=>t.scene)}set scene(t){this.set({scene:t})}get extensions(){return this.get(t=>t.extensions)}set extensions(t){this.set({extensions:t})}get ground(){return this.get(t=>t.ground)}set ground(t){this.set({ground:u.is.obj(t)?t:(0,u.Ig)(t)})}}return r.\u0275fac=function(){let p;return function(i){return(p||(p=n.n5z(r)))(i||r)}}(),r.\u0275dir=n.lG2({type:r,inputs:{frames:"frames",near:"near",far:"far",resolution:"resolution",background:"background",map:"map",files:"files",path:"path",preset:"preset",scene:"scene",extensions:"extensions",ground:"ground"},features:[n.qOj]}),r})(),Mt=(()=>{class r{constructor(t){this.host=t}set ngtSobaEnvironmentPassThrough(t){this.assertWrapper(t),t.select(t.select(i=>i.frames).pipe((0,u.Xb)()),t.select(i=>i.near).pipe((0,u.Xb)()),t.select(i=>i.far).pipe((0,u.Xb)()),t.select(i=>i.resolution).pipe((0,u.Xb)()),t.select(i=>i.background).pipe((0,u.Xb)()),t.select(i=>i.map).pipe((0,u.Xb)()),t.select(i=>i.files).pipe((0,u.Xb)()),t.select(i=>i.path).pipe((0,u.Xb)()),t.select(i=>i.preset).pipe((0,u.Xb)()),t.select(i=>i.scene).pipe((0,u.Xb)()),t.select(i=>i.extensions).pipe((0,u.Xb)()),t.select(i=>i.ground).pipe((0,u.Xb)())).pipe((0,w.R)(t.destroy$)).subscribe(()=>{this.host.frames=t.frames,this.host.near=t.near,this.host.far=t.far,this.host.resolution=t.resolution,this.host.background=t.background,this.host.map=t.map,this.host.files=t.files,this.host.path=t.path,this.host.preset=t.preset,this.host.scene=t.scene,this.host.extensions=t.extensions,this.host.ground=t.ground})}assertWrapper(t){if(!(t instanceof tt))throw new Error("[ngtSobaEnvironmentPassThrough] wrapper is not an NgtSobaEnvironmentGeneric")}}return r.\u0275fac=function(t){return new(t||r)(n.Y36(tt,10))},r.\u0275dir=n.lG2({type:r,selectors:[["","ngtSobaEnvironmentPassThrough",""]],inputs:{ngtSobaEnvironmentPassThrough:"ngtSobaEnvironmentPassThrough"}}),r})(),Et=(()=>{class r extends u.gU{constructor(t,i){super(),this.loader=t,this.store=i,this.setTexture=this.effect((0,u.oe)(()=>{const{textureRef:v,extensions:E,preset:x}=this.get();let{files:d,path:T}=this.get();if(x){if(!(x in L.n))throw new Error("Preset must be one of: "+Object.keys(L.n).join(", "));d=L.n[x],T="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const U=Array.isArray(d),et=this.loader.use(U?o.cBK:z,U?[d]:d,nt=>{nt.setPath(T),E&&E(nt)}).subscribe(nt=>{const mt=U?nt[0]:nt;mt.mapping=U?o.fY$:o.dSO,v.set(mt)});return()=>{et.unsubscribe()}})),this.set({textureRef:new u.Rl})}use(t){this.useSubscription&&this.useSubscription.unsubscribe();const i=t({files:["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:""}),v=(0,$.b)(i)?i:(0,yt.of)(i);return this.set(v),this.useSubscription=this.onCanvasReady(this.store.ready$,()=>(this.setTexture(this.select(this.select(E=>E.path),this.select(E=>E.files),this.select(E=>E.preset).pipe((0,u.Xb)()),this.select(E=>E.extensions).pipe((0,u.Xb)()))),()=>{this.useSubscription&&this.useSubscription.unsubscribe()}),!0),this.get(E=>E.textureRef)}}return r.\u0275fac=function(t){return new(t||r)(n.LFG(u.gj),n.LFG(u.W7))},r.\u0275prov=n.Yz7({token:r,factory:r.\u0275fac}),r})(),Tt=(()=>{class r extends tt{constructor(){super(...arguments),this.setEnvironment=this.effect((0,u.oe)(()=>{const{map:t,background:i,scene:v}=this.get(),E=this.store.get(x=>x.scene);if(t){const x=Ct(v||E),d=x.background,T=x.environment;return"only"!==i&&(x.environment=t),i&&(x.background=t),()=>{"only"!==i&&(x.environment=T),i&&(x.background=d)}}}))}preInit(){super.preInit(),this.set(t=>{var i;return{background:null!==(i=t.background)&&void 0!==i&&i}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.setEnvironment(this.select(this.store.select(t=>t.scene),this.select(t=>t.background),this.select(t=>t.map),this.select(t=>t.scene).pipe((0,u.Xb)())))})})}}return r.\u0275fac=function(){let p;return function(i){return(p||(p=n.n5z(r)))(i||r)}}(),r.\u0275cmp=n.Xpm({type:r,selectors:[["ngt-soba-environment-map","map",""]],features:[n._Bn([{provide:tt,useExisting:r}]),n.qOj],attrs:F,ngContentSelectors:I,decls:1,vars:0,template:function(t,i){1&t&&(n.F$t(),n.Hsn(0))},encapsulation:2,changeDetection:0}),r})(),Ot=(()=>{class r extends tt{constructor(t,i,v,E,x){super(t,i,v,E),this.environmentResolver=x,this.setEnvironment=this.effect((0,u.oe)(({texture:d})=>{const T=this.store.get(St=>St.scene),{background:U,scene:ut}=this.get(),et=Ct(ut||T),nt=et.background,mt=et.environment;return"only"!==U&&(et.environment=d),U&&(et.background=d),()=>{"only"!==U&&(et.environment=mt),U&&(et.background=nt)}}))}preInit(){super.preInit(),this.set(t=>{var i;return{background:null!==(i=t.background)&&void 0!==i&&i}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{const t=this.environmentResolver.use(i=>this.select(this.select(v=>v.files).pipe((0,ct.O)(i.files)),this.select(v=>v.path).pipe((0,ct.O)(i.path)),this.select(v=>v.preset).pipe((0,u.Xb)()),this.select(v=>v.extensions).pipe((0,u.Xb)()),(v,E,x,d)=>({files:v,path:E,preset:x,extensions:d})));this.setEnvironment(this.select(t.pipe((0,y.h)(i=>!!i)),this.select(i=>i.background),this.select(i=>i.scene).pipe((0,u.Xb)()),this.store.select(i=>i.scene),i=>({texture:i})))})})}}return r.\u0275fac=function(t){return new(t||r)(n.Y36(n.R0b),n.Y36(u.W7),n.Y36(u.cz,12),n.Y36(u.Aw,12),n.Y36(Et))},r.\u0275cmp=n.Xpm({type:r,selectors:[["ngt-soba-environment-cube"]],features:[n._Bn([{provide:tt,useExisting:r},Et]),n.qOj],ngContentSelectors:I,decls:1,vars:0,template:function(t,i){1&t&&(n.F$t(),n.Hsn(0))},encapsulation:2,changeDetection:0}),r})(),Bt=(()=>{class r{constructor(t){this.templateRef=t}}return r.\u0275fac=function(t){return new(t||r)(n.Y36(n.Rgc))},r.\u0275dir=n.lG2({type:r,selectors:[["ng-template","ngt-soba-environment-content",""]]}),r})(),At=(()=>{class r extends tt{constructor(){super(...arguments),this.virtualScene=new u.Rl((0,u.Pl)(new o.xsS,()=>this.store.get())),this.cubeCamera=new u.Rl,this.count=1,this.fbo$=this.select(t=>t.fbo),this.setEnvironment=this.effect((0,u.oe)(()=>{const{gl:t,scene:i}=this.store.get(),{frames:v,scene:E,background:x,fbo:d}=this.get();1===v&&this.cubeCamera.value.update(t,this.virtualScene.value);const T=Ct(E||i),U=T.background,ut=T.environment;return"only"!==x&&(T.environment=d.texture),x&&(T.background=d.texture),()=>{"only"!==x&&(T.environment=ut),x&&(T.background=U)}}))}preInit(){super.preInit(),this.set(t=>{var i,v,E,x,d;return{near:null!==(i=t.near)&&void 0!==i?i:1,far:null!==(v=t.far)&&void 0!==v?v:1e3,resolution:null!==(E=t.resolution)&&void 0!==E?E:256,frames:null!==(x=t.frames)&&void 0!==x?x:1,background:null!==(d=t.background)&&void 0!==d&&d}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.set(this.select(this.select(t=>t.resolution),t=>{const i=new o.oAp(t);return i.texture.type=o.cLu,{fbo:i}})),this.setEnvironment(this.select(this.select(),this.cubeCamera.pipe((0,y.h)(t=>!!t))))})})}onBeforeRender(){const{camera:t,frames:i}=this.get(),v=this.store.get(E=>E.gl);t&&(i===1/0||this.count<i)&&(t.update(v,this.virtualScene.value),this.count++)}}return r.\u0275fac=function(){let p;return function(i){return(p||(p=n.n5z(r)))(i||r)}}(),r.\u0275cmp=n.Xpm({type:r,selectors:[["ngt-soba-environment-portal"]],contentQueries:function(t,i,v){if(1&t&&n.Suo(v,Bt,7),2&t){let E;n.iGM(E=n.CRH())&&(i.content=E.first)}},features:[n._Bn([{provide:tt,useExisting:r}]),n.qOj],decls:7,vars:7,consts:[[3,"ref"],[4,"ngTemplateOutlet"],[3,"ref","args","beforeRender",4,"ngIf"],[3,"ngtSobaEnvironmentPassThrough",4,"ngIf","ngIfElse"],["environmentMap",""],[3,"ref","args","beforeRender"],[3,"ngtSobaEnvironmentPassThrough"],[3,"ngtSobaEnvironmentPassThrough","map"]],template:function(t,i){if(1&t&&(n.TgZ(0,"ngt-portal",0),n.YNc(1,D,1,0,"ng-container",1),n.YNc(2,Q,1,6,"ngt-cube-camera",2),n.ALo(3,"async"),n.YNc(4,Y,1,1,"ngt-soba-environment-cube",3),n.YNc(5,k,1,2,"ng-template",null,4,n.W1O),n.qZA()),2&t){const v=n.MAs(6);n.Q6J("ref",i.virtualScene),n.xp6(1),n.Q6J("ngTemplateOutlet",i.content.templateRef),n.xp6(1),n.Q6J("ngIf",n.lcZ(3,5,i.fbo$)),n.xp6(2),n.Q6J("ngIf",i.files||i.preset)("ngIfElse",v)}},directives:[it.WS,j.tP,j.O5,J.e,Ot,Mt,Tt],pipes:[j.Ov],encapsulation:2,changeDetection:0}),r})(),Ut=(()=>{class r extends tt{constructor(t,i,v,E,x){super(t,i,v,E),this.environmentResolver=x,this.materialRef=new u.Rl,this.vertexShader="\nvarying vec3 vWorldPosition;\n\nvoid main() {\n  vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n  vWorldPosition = worldPosition.xyz;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",this.uniforms={cubemap:{value:null},height:{value:15},radius:{value:60}},this.environmentGroundViewModel$=this.select(this.select(d=>d.texture),this.select(d=>d.scale),this.select(d=>d.fragment),(d,T,U)=>({texture:d,scale:T,fragment:U})),this.setDefines=this.effect((0,K.b)(()=>{var d,T;const{isCubeMap:U,texture:ut}=this.get(),nt=(null!==(T=U?null===(d=ut.image[0])||void 0===d?void 0:d.width:ut.image.width)&&void 0!==T?T:1024)/4,mt=Math.floor(Math.log2(nt)),St=Math.pow(2,mt),Ft=3*Math.max(St,112);this.set({defines:[U?"#define ENVMAP_TYPE_CUBE":"","#define CUBEUV_TEXEL_WIDTH "+1/Ft,"#define CUBEUV_TEXEL_HEIGHT "+1/(4*St),`#define CUBEUV_MAX_MIP ${mt}.0`,""]})})),this.setFragment=this.effect((0,K.b)(()=>{const d=this.get(T=>T.defines);this.set({fragment:d.join("\n")+"\n#define ENVMAP_TYPE_CUBE_UV\n\nvarying vec3 vWorldPosition;\n\nuniform float radius;\nuniform float height;\n\n#ifdef ENVMAP_TYPE_CUBE\n  uniform samplerCube cubemap;\n#else\n  uniform sampler2D cubemap;\n#endif\n\n// From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\nfloat diskIntersect( in vec3 ro, in vec3 rd, vec3 c, vec3 n, float r ) {\n    vec3  o = ro - c;\n    float t = -dot(n, o)/dot(rd,n);\n    vec3  q = o + rd * t;\n    return (dot(q, q) < r * r) ? t : 1e6;\n}\n\n// From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm\nfloat sphereIntersect( in vec3 ro, in vec3 rd, in vec3 ce, float ra ) {\n    vec3 oc = ro - ce;\n    float b = dot( oc, rd );\n    float c = dot( oc, oc ) - ra*ra;\n    float h = b * b - c;\n    if(h < 0.0) -1.0;\n    h = sqrt( h );\n    return -b + h;\n}\n\nvec3 project() {\n  vec3 p = normalize(vWorldPosition);\n  vec3 camPos = cameraPosition;\n  camPos.y -= height;\n\n  float intersection = sphereIntersect(camPos, p, vec3(0.), radius);\n  if(intersection > 0.) {\n    vec3 h = vec3(0.0,-height,0.0);\n    float intersection2 = diskIntersect(camPos, p, h, vec3(0.0,-1.0,0.0), radius);\n    p = (camPos + min(intersection, intersection2) * p) / radius;\n  }\n  else {\n    p = vec3(0.0,1.0,0.0);\n  }\n  return p;\n}\n\n#include <common>\n#include <cube_uv_reflection_fragment>\n\nvoid main(){\n  vec3 projectedWorldPosition = project();\n\n  #ifdef ENVMAP_TYPE_CUBE\n    vec3 outcolor = textureCube(cubemap, projectedWorldPosition).rgb;\n  #else\n    vec3 direction = normalize(projectedWorldPosition);\n    vec2 uv = equirectUv(direction);\n    vec3 outcolor = texture2D(cubemap, uv).rgb;\n  #endif\n\n  gl_FragColor = vec4(outcolor, 1.0);\n\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n}"})})),this.setMaterialOptions=this.effect((0,K.b)(()=>{var d;const T=this.get(U=>U.ground);this.set({height:null==T?void 0:T.height,radius:null==T?void 0:T.radius,scale:null!==(d=null==T?void 0:T.scale)&&void 0!==d?d:1e3})})),this.setHeightUniform=this.effect((0,pt.z)((0,ot.Q)(C.Z),(0,K.b)(()=>{const{height:d}=this.get();this.materialRef.value&&d&&(this.materialRef.value.uniforms.height.value=d)}))),this.setRadiusUniform=this.effect((0,pt.z)((0,ot.Q)(C.Z),(0,K.b)(()=>{const{radius:d}=this.get();this.materialRef.value&&d&&(this.materialRef.value.uniforms.radius.value=d)}))),this.setCubeMapUniform=this.effect((0,pt.z)((0,ot.Q)(C.Z),(0,K.b)(()=>{const{texture:d}=this.get();this.materialRef.value&&(this.materialRef.value.uniforms.cubemap.value=d)})))}ngOnInit(){super.ngOnInit(),this.onCanvasReady(this.store.ready$,()=>{const t=this.environmentResolver.use(i=>this.select(this.select(v=>v.files).pipe((0,ct.O)(i.files)),this.select(v=>v.path).pipe((0,ct.O)(i.path)),this.select(v=>v.preset).pipe((0,u.Xb)()),this.select(v=>v.extensions).pipe((0,u.Xb)()),(v,E,x,d)=>({files:v,path:E,preset:x,extensions:d})));this.set(this.select(this.select(i=>i.map).pipe((0,u.Xb)()),t.pipe((0,y.h)(i=>!!i)),(i,v)=>(i&&(v=i),{texture:v,isCubeMap:wt(v)}))),this.setDefines(this.select(i=>i.texture).pipe((0,H.q)(1))),this.setFragment(this.select(i=>i.defines)),this.setMaterialOptions(this.select(i=>i.ground)),this.setHeightUniform(this.select(this.materialRef.pipe((0,y.h)(i=>!!i)),this.select(i=>i.height).pipe((0,u.Xb)()))),this.setRadiusUniform(this.select(this.materialRef.pipe((0,y.h)(i=>!!i)),this.select(i=>i.radius).pipe((0,u.Xb)()))),this.setCubeMapUniform(this.select(this.materialRef.pipe((0,y.h)(i=>!!i)),this.select(i=>i.texture)))})}}return r.\u0275fac=function(t){return new(t||r)(n.Y36(n.R0b),n.Y36(u.W7),n.Y36(u.cz,12),n.Y36(u.Aw,12),n.Y36(Et))},r.\u0275cmp=n.Xpm({type:r,selectors:[["ngt-soba-environment-ground"]],features:[n._Bn([{provide:tt,useExisting:r},Et]),n.qOj],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ngtSobaEnvironmentPassThrough","map"],[3,"scale"],[3,"args"],[3,"ref","side","vertexShader","fragmentShader","uniforms"]],template:function(t,i){1&t&&(n.YNc(0,M,6,12,"ng-container",0),n.ALo(1,"async")),2&t&&n.Q6J("ngIf",n.lcZ(1,1,i.environmentGroundViewModel$))},directives:[j.O5,Tt,Mt,dt.o,P.v,W.y],pipes:[j.Ov,a.i],encapsulation:2,changeDetection:0}),r})(),Ht=(()=>{class r extends tt{}return r.\u0275fac=function(){let p;return function(i){return(p||(p=n.n5z(r)))(i||r)}}(),r.\u0275cmp=n.Xpm({type:r,selectors:[["ngt-soba-environment"]],contentQueries:function(t,i,v){if(1&t&&n.Suo(v,Bt,5),2&t){let E;n.iGM(E=n.CRH())&&(i.content=E.first)}},features:[n._Bn([{provide:tt,useExisting:r}]),n.qOj],ngContentSelectors:I,decls:4,vars:2,consts:[[3,"ngtSobaEnvironmentPassThrough",4,"ngIf","ngIfElse"],["mapOrPortalOrCube",""],[3,"ngtSobaEnvironmentPassThrough"],[3,"ngtSobaEnvironmentPassThrough","map",4,"ngIf","ngIfElse"],["portalOrCube",""],[3,"ngtSobaEnvironmentPassThrough","map"],["cube",""],["ngt-soba-environment-content",""],[4,"ngTemplateOutlet"]],template:function(t,i){if(1&t&&(n.F$t(),n.YNc(0,c,1,1,"ngt-soba-environment-ground",0),n.YNc(1,xt,3,2,"ng-template",null,1,n.W1O),n.Hsn(3)),2&t){const v=n.MAs(2);n.Q6J("ngIf",!!i.ground)("ngIfElse",v)}},directives:[j.O5,Ut,Mt,Tt,At,Bt,j.tP,Ot],encapsulation:2,changeDetection:0}),r})(),jt=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=n.oAB({type:r}),r.\u0275inj=n.cJS({imports:[[u.yh,j.ez,ht.UC,rt.M$,bt.Jv,Z.RQ,u.g8]]}),r})()},744:(_t,at,l)=>{l.d(at,{n:()=>u});const u={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"}},7389:(_t,at,l)=>{l.d(at,{fH:()=>pt,vc:()=>ot});var u=l(7017),ht=l(8427),bt=l(1487),Z=l(6963),rt=l(3080);class j extends Z.Kj0{constructor(){super(new Z.DvJ(1,1,1),j.material)}}(0,rt.Z)(j,"SkyShader",{uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Z.Pa4},up:{value:new Z.Pa4(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","#include <tonemapping_fragment>","#include <encodings_fragment>","}"].join("\n")}),(0,rt.Z)(j,"material",new Z.jyz({name:"SkyShader",fragmentShader:j.SkyShader.fragmentShader,vertexShader:j.SkyShader.vertexShader,uniforms:Z.rDY.clone(j.SkyShader.uniforms),side:Z._Li,depthWrite:!1}));var w=l(1858);const $=function(C){return{sky:C}};function yt(C,H){if(1&C&&w.GkF(0,1),2&C){const o=w.oxw();w.Q6J("ngTemplateOutlet",o.content.templateRef)("ngTemplateOutletContext",w.VKq(2,$,o.instance))}}const ct=["*"];function y(C,H,o=new Z.Pa4){const z=Math.PI*(C-.5),L=2*Math.PI*(H-.5);return o.x=Math.cos(L),o.y=Math.sin(z),o.z=Math.sin(L),o}let K=(()=>{class C{constructor(o){this.templateRef=o}static ngTemplateContextGuard(o,z){return!0}}return C.\u0275fac=function(o){return new(o||C)(w.Y36(w.Rgc))},C.\u0275dir=w.lG2({type:C,selectors:[["ng-template","ngt-soba-sky-content",""]]}),C})(),pt=(()=>{class C extends u.uT{constructor(){super(...arguments),this.setScale=this.effect((0,bt.b)(()=>{const o=this.get(z=>z.distance);this.instance.value.scale.copy((new Z.Pa4).setScalar(o))})),this.updateMaterialUniforms=this.effect((0,bt.b)(()=>{const{mieCoefficient:o,mieDirectionalG:z,rayleigh:L,sunPosition:n,turbidity:it}=this.get(),J=this.instance.value.material;J.uniforms.mieCoefficient.value=o,J.uniforms.mieDirectionalG.value=z,J.uniforms.rayleigh.value=L,J.uniforms.sunPosition.value=n,J.uniforms.turbidity.value=it,(0,u.QF)(J)}))}set distance(o){this.set({distance:(0,u.su)(o)})}set sunPosition(o){this.set({sunPosition:o})}set inclination(o){this.set({inclination:(0,u.su)(o)})}set azimuth(o){this.set({azimuth:(0,u.su)(o)})}set mieCoefficient(o){this.set({mieCoefficient:(0,u.su)(o)})}set mieDirectionalG(o){this.set({mieDirectionalG:(0,u.su)(o)})}set rayleigh(o){this.set({rayleigh:(0,u.su)(o)})}set turbidity(o){this.set({turbidity:(0,u.su)(o)})}preInit(){super.preInit(),this.set(o=>{var z,L,n,it,J,dt,P,W;const a=null!==(z=o.inclination)&&void 0!==z?z:.6,F=null!==(L=o.azimuth)&&void 0!==L?L:.1;return{inclination:a,azimuth:F,distance:null!==(n=o.distance)&&void 0!==n?n:1e3,mieCoefficient:null!==(it=o.mieCoefficient)&&void 0!==it?it:.005,mieDirectionalG:null!==(J=o.mieDirectionalG)&&void 0!==J?J:.8,rayleigh:null!==(dt=o.rayleigh)&&void 0!==dt?dt:.5,turbidity:null!==(P=o.turbidity)&&void 0!==P?P:10,sunPosition:null!==(W=o.sunPosition)&&void 0!==W?W:y(a,F)}})}postInit(){super.postInit(),this.setScale(this.select(o=>o.distance)),this.updateMaterialUniforms(this.select(this.select(o=>o.mieCoefficient),this.select(o=>o.mieDirectionalG),this.select(o=>o.rayleigh),this.select(o=>o.sunPosition),this.select(o=>o.turbidity)))}get meshType(){return j}}return C.\u0275fac=function(){let H;return function(z){return(H||(H=w.n5z(C)))(z||C)}}(),C.\u0275cmp=w.Xpm({type:C,selectors:[["ngt-soba-sky"]],contentQueries:function(o,z,L){if(1&o&&w.Suo(L,K,5),2&o){let n;w.iGM(n=w.CRH())&&(z.content=n.first)}},inputs:{distance:"distance",sunPosition:"sunPosition",inclination:"inclination",azimuth:"azimuth",mieCoefficient:"mieCoefficient",mieDirectionalG:"mieDirectionalG",rayleigh:"rayleigh",turbidity:"turbidity"},features:[w.qOj],ngContentSelectors:ct,decls:2,vars:1,consts:[[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(o,z){1&o&&(w.F$t(),w.YNc(0,yt,1,4,"ng-container",0),w.Hsn(1)),2&o&&w.Q6J("ngIf",z.content)},directives:[ht.O5,ht.tP],encapsulation:2,changeDetection:0}),C})(),ot=(()=>{class C{}return C.\u0275fac=function(o){return new(o||C)},C.\u0275mod=w.oAB({type:C}),C.\u0275inj=w.cJS({imports:[[ht.ez]]}),C})()},6758:(_t,at,l)=>{l.d(at,{f4:()=>Y,sz:()=>Q,YS:()=>k});var u=l(7017),ht=l(280),bt=l(5936),Z=l(1412),rt=l(8427),j=l(5359);function w(f){return(0,j.h)((M,c)=>f<=c)}var $=l(1926),yt=l(506),ct=l(1150),y=l(1487),K=l(7319),pt=l(6879),ot=l(6963),C=l(4480),H=l(9445),o=l(1858),z=l(8187),L=l(5648),n=l(5520),it=l(475),J=l(4271),dt=l(3704);const P=function(f){return{group:f}};function W(f,M){if(1&f&&o.GkF(0,9),2&f){const c=o.oxw();o.Q6J("ngTemplateOutlet",c.content.templateRef)("ngTemplateOutletContext",o.VKq(2,P,c.innerGroup))}}function a(f,M){if(1&f&&o._UZ(0,"ngt-soba-contact-shadows",10),2&f){const c=o.oxw();o.Q6J("scale",2*c.radius)("far",c.radius/2)("blur",c.contactShadow.blur)("opacity",c.contactShadow.opacity)("position",c.contactShadow.position)}}function F(f,M){if(1&f&&o._UZ(0,"ngt-soba-environment",11),2&f){const c=o.oxw();o.Q6J("preset",c.environment)}}const I=function(f,M,c){return[f,M,c]},D=function(){return["shadow","bias"]},V={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};let Q=(()=>{class f{constructor(c){this.templateRef=c}static ngTemplateContextGuard(c,N){return!0}}return f.\u0275fac=function(c){return new(c||f)(o.Y36(o.Rgc))},f.\u0275dir=o.lG2({type:f,selectors:[["ng-template","ngt-soba-stage-content",""]]}),f})(),Y=(()=>{class f extends u.Fq{constructor(){super(...arguments),this.setDimensions=this.effect((0,$.z)((0,yt.Q)(ct.z),(0,y.b)(()=>{const{innerGroup:c,outerGroup:N}=this.get();if(c.value&&N.value){N.value.position.set(0,0,0),N.value.updateWorldMatrix(!0,!0);const O=(new ot.ZzF).setFromObject(c.value),A=new ot.Pa4,X=new ot.aLr,q=O.max.y-O.min.y,lt=O.max.x-O.min.x;O.getCenter(A),O.getBoundingSphere(X),this.zone.run(()=>{this.set({radius:X.radius,width:lt,height:q})}),N.value.position.set(-A.x,q/2-A.y,-A.z)}}))),this.updateControls=this.effect((0,y.b)(()=>{const{adjustCamera:c,width:N,height:O,radius:A}=this.get(),{camera:X,controls:q}=this.store.get();if(c){const lt=A/(O>N?1.5:2.5);X.position.set(0,.5*A,2.5*A),X.near=.1,X.far=Math.max(5e3,4*A),X.lookAt(0,lt,0),q&&(q.target.set(0,lt,0),q.update())}}))}get shadows(){return this.get(c=>c.shadows)}set shadows(c){this.set({shadows:(0,u.Ig)(c)})}get adjustCamera(){return this.get(c=>c.adjustCamera)}set adjustCamera(c){this.set({adjustCamera:(0,u.Ig)(c)})}get environment(){return this.get(c=>c.environment)}set environment(c){this.set({environment:c})}get intensity(){return this.get(c=>c.intensity)}set intensity(c){this.set({intensity:(0,u.su)(c)})}get ambience(){return this.get(c=>c.ambience)}set ambience(c){this.set({ambience:(0,u.su)(c)})}get preset(){return this.get(c=>c.preset)}set preset(c){this.set({preset:c})}get shadowBias(){return this.get(c=>c.shadowBias)}set shadowBias(c){this.set({shadowBias:(0,u.su)(c)})}get contactShadow(){return this.get(c=>c.contactShadow)}set contactShadow(c){this.set({contactShadow:c})}get innerGroup(){return this.get(c=>c.innerGroup)}get outerGroup(){return this.get(c=>c.outerGroup)}get radius(){return this.get(c=>c.radius)}get width(){return this.get(c=>c.width)}get height(){return this.get(c=>c.height)}get config(){return V[this.get(c=>c.preset)]}preInit(){super.preInit(),this.set(c=>{var N,O,A,X,q,lt,xt;return{innerGroup:new u.Rl,outerGroup:new u.Rl,radius:0,width:0,height:0,shadows:null===(N=c.shadows)||void 0===N||N,adjustCamera:null===(O=c.adjustCamera)||void 0===O||O,environment:null!==(A=c.environment)&&void 0!==A?A:"city",intensity:null!==(X=c.intensity)&&void 0!==X?X:1,preset:null!==(q=c.preset)&&void 0!==q?q:"rembrandt",shadowBias:null!==(lt=c.shadowBias)&&void 0!==lt?lt:0,contactShadow:null!==(xt=c.contactShadow)&&void 0!==xt?xt:{blur:2,opacity:.5,position:[0,0,0]}}})}ngAfterContentInit(){this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.setDimensions(this.select(this.innerGroup.pipe((0,j.h)(c=>!!c)),this.outerGroup.pipe((0,j.h)(c=>!!c)),this.children.changes.pipe((0,K.w)(()=>(0,pt.a)(this.children.map(c=>c())))))),this.updateControls(this.select(this.store.select(c=>c.controls),this.select(c=>c.radius).pipe(w(1)),this.select(c=>c.height).pipe(w(1)),this.select(c=>c.width).pipe(w(1)),this.select(c=>c.adjustCamera)))})})}}return f.\u0275fac=function(){let M;return function(N){return(M||(M=o.n5z(f)))(N||f)}}(),f.\u0275cmp=o.Xpm({type:f,selectors:[["ngt-soba-stage"]],contentQueries:function(c,N,O){if(1&c&&(o.Suo(O,Q,5),o.Suo(O,u.Dh,4)),2&c){let A;o.iGM(A=o.CRH())&&(N.content=A.first),o.iGM(A=o.CRH())&&(N.children=A)}},inputs:{shadows:"shadows",adjustCamera:"adjustCamera",environment:"environment",intensity:"intensity",ambience:"ambience",preset:"preset",shadowBias:"shadowBias",contactShadow:"contactShadow"},features:[o._Bn([(0,u.Hm)(f,M=>M.innerGroup)]),o.qOj],decls:10,vars:24,consts:[["skipParent","",3,"ngtObjectOutputs","ngtObjectInputs"],[3,"ref"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"scale","far","blur","opacity","position",4,"ngIf"],[3,"preset",4,"ngIf"],[3,"intensity"],["penumbra","1",3,"position","intensity","castShadow"],[3,"attach","value"],[3,"position","intensity"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"scale","far","blur","opacity","position"],[3,"preset"]],template:function(c,N){1&c&&(o.TgZ(0,"ngt-group",0)(1,"ngt-group",1)(2,"ngt-group",1),o.YNc(3,W,1,4,"ng-container",2),o.qZA()(),o.YNc(4,a,1,5,"ngt-soba-contact-shadows",3),o.YNc(5,F,1,1,"ngt-soba-environment",4),o._UZ(6,"ngt-ambient-light",5),o.TgZ(7,"ngt-spot-light",6),o._UZ(8,"ngt-value",7),o.qZA(),o._UZ(9,"ngt-point-light",8),o.qZA()),2&c&&(o.Q6J("ngtObjectOutputs",N)("ngtObjectInputs",N),o.xp6(1),o.Q6J("ref",N.outerGroup),o.xp6(1),o.Q6J("ref",N.innerGroup),o.xp6(1),o.Q6J("ngIf",N.content),o.xp6(1),o.Q6J("ngIf",N.contactShadow),o.xp6(1),o.Q6J("ngIf",N.environment),o.xp6(1),o.Q6J("intensity",N.intensity/3),o.xp6(1),o.Q6J("position",o.kEZ(15,I,N.config.main[0]*N.radius,N.config.main[1]*N.radius,N.config.main[2]*N.radius))("intensity",2*N.intensity)("castShadow",N.shadows),o.xp6(1),o.Q6J("attach",o.DdM(19,D))("value",N.shadowBias),o.xp6(1),o.Q6J("position",o.kEZ(20,I,N.config.fill[0]*N.radius,N.config.fill[1]*N.radius,N.config.fill[2]*N.radius))("intensity",N.intensity))},directives:[z.U,L.V,rt.O5,rt.tP,C.g,H.$5,n.w,it.K,J.m,dt.H],encapsulation:2,changeDetection:0}),f})(),k=(()=>{class f{}return f.\u0275fac=function(c){return new(c||f)},f.\u0275mod=o.oAB({type:f}),f.\u0275inj=o.cJS({imports:[[bt.I,u.y2,rt.ez,C.h,H.wj,Z.EQ,Z.Hk,ht.pk,Z.GK]]}),f})()}}]);